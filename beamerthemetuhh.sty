\mode<presentation>

% Requirement
\RequirePackage{tikz}
\RequirePackage{enumitem}

% Settings
\useinnertheme{tuhh}
\useoutertheme{tuhh}
\usecolortheme{tuhh}
\usefonttheme{tuhh}

\geometry{papersize={338.67mm, 190.50mm}}
\setbeamersize{text margin left  = 21.30mm, 
               text margin right = 61.67mm} 

\setbeamertemplate{navigation symbols}{}

\let\oldItemize\itemize
\let\oldItemizeEnd\enditemize
\renewenvironment{itemize}{\oldItemize\addtolength{\itemsep}{1.5mm}}{\oldItemizeEnd}

\let\oldEnumerate\enumerate
\let\oldEnumerateEnd\endenumerate
\renewenvironment{enumerate}{\oldEnumerate\addtolength{\itemsep}{1.5mm}}{\oldEnumerateEnd}

\setlist[enumerate]{leftmargin=\leftmargini, label=\makebox[0.5em][c]{\arabic*}.}
\setlist[itemize]{leftmargin=\leftmargini, label=\raisebox{0.375ex}{\footnotesize$\bullet$}}

% A default frame should always use a content_frame background
\BeforeBeginEnvironment{frame}{%
  \setbeamertemplate{content_frame}{\usebeamertemplate{content_frame_background}}
  \usebeamertemplate{content_frame}%
}

% Titlepage definition
\makeatletter
\define@key{beamerframe}{titlepage}[true]{%
  \setbeamertemplate{content_frame}{\usebeamertemplate{titlepage_frame}}
  \usebeamertemplate{content_frame}%
  }
\makeatother

\renewcommand*{\titlepage}{
  \begin{frame}[titlepage]
    \usebeamertemplate{titlepage}
  \end{frame}
}

% Finalpage definition
\makeatletter
\define@key{beamerframe}{finalpage}[true]{%
  \setbeamertemplate{content_frame}{\usebeamertemplate{endpage_frame}}
  \usebeamertemplate{content_frame}%
  }
\makeatother

% Custom final page setup
\newcommand{\finalpage}{
  \begin{frame}[finalpage]
  \end{frame}
}

% Renew TOC command to indent it to the grey rectangle
\let\oldTableOfContents\tableofcontents
\renewcommand*{\tableofcontents}{
  \begin{minipage}{98.99mm}
    \hfill
  \end{minipage}
  \begin{minipage}[c][137.74mm]{0.4\textwidth}
    \oldTableOfContents
  \end{minipage}
}

% Add section numbers to TOC
\setbeamertemplate{section in toc}{\makebox[0.5em][c]{\inserttocsectionnumber}.~\inserttocsection}

% Adjust TOC entry spacing
\makeatletter
\patchcmd{\beamer@sectionintoc}
  {\vfill}
  {\vskip 1em}
  {}
  {}

% Finalpage definition
\makeatletter
\define@key{beamerframe}{agenda}[true]{%
  \setbeamertemplate{content_frame}{\usebeamertemplate{agenda_frame}}
  \usebeamertemplate{content_frame}%
  }
\makeatother

% Plain page definition
\makeatletter
\define@key{beamerframe}{plain}[true]{%
  \setbeamertemplate{content_frame}{\usebeamertemplate{plain_background}}
  \usebeamertemplate{content_frame}%
  }
\makeatother
\mode<all>